(function(){var t,s;s=function(){function t(){}return t.merge_options=function(t,s){var i,e;e={};for(i in t)e[i]=t[i];for(i in s)e[i]=s[i];return e},t}(),t=function(){function t(t){var s;null==t&&(t={}),this._set_options(t),this._callbacks=[],s=this,this.ready=!1,this.status="processing",this.options.timeout>0&&(this._timeout_process=setTimeout(function(){return s._finish("timeout")},this.options.timeout)),this._time_started=(new Date).getTime(),this._last_checked=this._time_started,this._success_iterations=0,this._preprocess=setTimeout(function(){return s._process=setInterval(function(){var t,i;return i=(new Date).getTime(),t=i-s._last_checked-s.options.frequency,s.options.min_delta<t&&t<s.options.max_delta?(s._success_iterations++,s._success_iterations>=s.options.iterations&&s._finish("success")):s._success_iterations=0,s._last_checked=i},s.options.frequency)},this.options.delay)}return t.defaults={delay:100,frequency:30,iterations:3,duration:null,scatter:5,min_delta:null,max_delta:null,timeout:null},t.prototype._set_options=function(t){return this.options=s.merge_options(this.constructor.defaults,t),null!=this.options.duration&&(this.options.iterations=Math.ceil(this.options.duration/this.options.frequency)),null==this.options.min_delta&&(this.options.min_delta=-this.options.scatter),null==this.options.max_delta?this.options.max_delta=this.options.scatter:void 0},t.prototype.info=function(){var t,s;return null!=this.time_passed?s=this.time_passed:(t=(new Date).getTime(),s=t-this._time_started),{status:this.status,time_passed:s,ready:this.ready,options:this.options}},t.prototype._finish=function(t){var s,i,e,n,o,r;for(null!=this._preprocess&&clearTimeout(this._preprocess),null!=this._process&&clearInterval(this._process),null!=this._timeout_process&&clearTimeout(this._timeout_process),this.ready=!0,this.status=t,n=(new Date).getTime(),this.time_passed=n-this._time_started,o=this._callbacks,r=[],i=0,e=o.length;e>i;i++)s=o[i],r.push(s.fn.call(s.self,this.info()));return r},t.prototype["do"]=function(t,s){return null==s&&(s=null),null==s&&(s=t,t=this),this.ready?s.call(t,this.info()):this._callbacks.push({fn:s,self:t}),this},t}(),window.Afterlag=t}).call(this);